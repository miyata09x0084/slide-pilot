# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# Multimode Lab Backend 環境変数スキーマ
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
#
# このファイルはCI/CDパイプラインで使用される環境変数の
# Single Source of Truthとして機能します。
#
# 使用方法:
#   1. 新規環境変数を追加する際は、このファイルを更新
#   2. scripts/sync-secrets.sh を実行してSecret Managerに同期
#   3. GitHub Actionsが自動的にこのスキーマを参照してデプロイ
#
# 最終更新: 2025-11-14
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# 【機密情報】Secret Managerで管理
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
secrets:
  # ─────────────────────────────────────────
  # OpenAI
  # ─────────────────────────────────────────
  - name: OPENAI_API_KEY
    description: OpenAI API key for GPT-4
    required: true

  # ─────────────────────────────────────────
  # Tavily Search
  # ─────────────────────────────────────────
  - name: TAVILY_API_KEY
    description: Tavily API key for AI news search
    required: true

  # ─────────────────────────────────────────
  # LangChain / LangGraph
  # ─────────────────────────────────────────
  - name: LANGCHAIN_API_KEY
    description: LangSmith API key for tracing
    required: true

  - name: LANGGRAPH_CLOUD_URL
    description: LangGraph Cloud deployment URL
    required: true
    example: "https://ht-indelible-butter-38-d617b23d72975313b7e6316cf615d8d0.us.langgraph.app"

  - name: LANGGRAPH_DEPLOYMENT_ID
    description: LangGraph deployment ID (use "local" for dev)
    required: true
    example: "production"

  # ─────────────────────────────────────────
  # Supabase
  # ─────────────────────────────────────────
  - name: SUPABASE_URL
    description: Supabase project URL
    required: true
    example: "https://smcgphoiyhroeqdwbvpr.supabase.co"

  - name: SUPABASE_SERVICE_KEY
    description: Supabase service role key (backend only)
    required: true

  - name: SUPABASE_ANON_KEY
    description: Supabase anon key (public-safe)
    required: true

  - name: SUPABASE_JWT_SECRET
    description: Supabase JWT secret for token verification
    required: true

  # ─────────────────────────────────────────
  # PostgreSQL
  # ─────────────────────────────────────────
  - name: POSTGRES_URI
    description: PostgreSQL connection string for LangGraph persistence
    required: true
    example: "postgresql://postgres:***@db.smcgphoiyhroeqdwbvpr.supabase.co:5432/postgres"

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# 【非機密情報】Cloud Run環境変数
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
env_vars:
  # ─────────────────────────────────────────
  # Slide configuration
  # ─────────────────────────────────────────
  - name: SLIDE_FORMAT
    value: "pdf"
    description: Output format (pdf/png/html/md)

  - name: SLIDE_THEME
    value: "apple-basic"
    description: Slidev theme

  # ─────────────────────────────────────────
  # Image generation
  # ─────────────────────────────────────────
  - name: ENABLE_IMAGE_GENERATION
    value: "false"
    description: Enable DALL-E image generation

  - name: IMAGE_MODEL
    value: "dall-e-3"
    description: OpenAI image model

  - name: IMAGE_SIZE
    value: "1024x1024"
    description: Generated image size

  - name: MAX_IMAGES
    value: "3"
    description: Max images per slide deck

  # ─────────────────────────────────────────
  # LangSmith tracing
  # ─────────────────────────────────────────
  - name: LANGCHAIN_TRACING_V2
    value: "true"
    description: Enable LangSmith tracing

  - name: LANGCHAIN_PROJECT
    value: "react-agent"
    description: LangSmith project name

  - name: LANGCHAIN_ENDPOINT
    value: "https://api.smith.langchain.com"
    description: LangSmith API endpoint

  # ─────────────────────────────────────────
  # Google OAuth (for local dev)
  # ─────────────────────────────────────────
  - name: GOOGLE_REDIRECT_URI
    value: "http://localhost:2024/auth/google/callback"
    description: Google OAuth redirect URI

  # ─────────────────────────────────────────
  # Video generation
  # ─────────────────────────────────────────
  - name: BG_JOB_ISOLATED_LOOPS
    value: "true"
    description: Disable LangGraph blocking detection for video rendering

  - name: VIDEO_ENABLED
    value: "true"
    description: Enable video narration feature
